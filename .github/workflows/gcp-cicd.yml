name: Release and Upload

on:
  push:
    # tags:
    #   - 'v*'
    branches:
      - add-github-actions

env:
  PROJECT_ID: ${{ secrets.GKE_PROJECT }}
  DEPLOYMENT_NAME: cnv-email-plugin
  IMAGE: cnv-email-plugin
  REGISTRY: europe-west3-docker.pkg.dev
  NAMESPACE: cnv-email-plugin

jobs:
  build-release:
    runs-on: ubuntu-latest
    environment: production

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build
        run: |-
          yarn
          yarn build

      - name: Test
        run: yarn test

      - name: Pack
        run: yarn pack

      - name: Create Tag
        id: create-tag
        uses: hennejg/github-tag-action@v4.1.jh1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          dry_run: true

      - name: Output tag action
        run: |-
          echo ${{ steps.create-tag.new_tag }}
          echo ${{ steps.create-tag.new_version }}
          echo ${{ steps.create-tag.previous-_tag }}
          echo ${{ steps.create-tag.changelog }}

      # - name: Create Release
      #   uses: ncipollo/release-action@v1
      #   with:
      #     artifacts: '*.tgz'
      #     commit: add-github-actions
      #     tag: v0.0.0-test5
      #     generateReleaseNotes: true
